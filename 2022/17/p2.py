import sys
from pathlib import Path

sys.path.append(str(Path(__file__).parent.parent.parent))

from aoclib.input import *
from itertools import cycle

rocks: list[tuple[tuple[int, int], ...]] = [
    ((2, 0), (3, 0), (4, 0), (5, 0)),
    ((2, 1), (3, 0), (3, 1), (3, 2), (4, 1)),
    ((2, 0), (3, 0), (4, 0), (4, 1), (4, 2)),
    ((2, 0), (2, 1), (2, 2), (2, 3)),
    ((2, 0), (2, 1), (3, 0), (3, 1))
]

g = [["."] * 7 for _ in range(100000)]
def move_rock(rock, direction):
    if direction == 'v':
        for x, y in rock:
            if y-1 < 0:
                raise ValueError
            if g[y-1][x] != ".":
                raise ValueError
        
        return tuple((x, y-1) for x, y in rock)
    elif direction == '>':
        for x, y in rock:
            if g[y][x+1] != ".":
                raise IndexError

        return tuple((x+1, y) for x, y in rock) 
    elif direction == '<':
        for x, y in rock:
            if x-1 < 0:
                raise IndexError
            if g[y][x-1] != ".":
                raise IndexError
            
        return tuple((x-1, y) for x, y in rock)
    else:
        raise KeyError


wind_index = -1
max_height = 0

height_diffs = []
prev_heights = [max_height]

for i, rock in enumerate(cycle(rocks)):
    if i == 10000:
        break

    rock = tuple((x, y + max_height+3) for x, y in rock)

    try:
        while True:
            try:
                wind_index += 1
                rock = move_rock(rock, input_string[wind_index % len(input_string)])
            except IndexError:
                pass
            rock = move_rock(rock, 'v')
    except ValueError:
        pass

    for x, y in rock:
        if y + 1 > max_height:
            max_height = y + 1

    height_diffs.append(max_height - prev_heights[-1])
    prev_heights.append(max_height)

    for x, y in rock:
        g[y][x] = "O"


# use highlighting/ctrl-f to find a repeating sequence
print(''.join(map(str, height_diffs)))

# bits leading up to the cycle
A = '13200122221322212132133201232212120023001304213210130400221012300132400012012130033001222013302133401334213300133400032002202132400200202302022201232213200132001334010130132401212012120021200230013222132101320013300123001330013020133020224212132023021302213340003001224012120132'
# cycle
B = '201220013220130401303001201133201330213040133201322003220121221322212222133001332013320122201222213022133021222013322133001032213242123021212212300121201230103040022000330003300121300332212222130201212213220133201320013200133201330013340132401320011211133221222012340130201213012301032101224013320133021002013020133021212012302012201334012220123021213012320133001332013200132201322013240123001224212120022201334013210030201332012340122401300213300122401232213020130321332012140133000232212301121221330213300133001330200302133001332013320130121302200222123021320013320022001334213222130401212010340122201322002322133201332012220123221304210342123201324203001132001304013002123021322213020132200202013320122100332213300123021303003220123421332012210032201230012200130221332012300121201212213201033200230013322132021332213220033201322013212013420222212320133201332012302133201222213211130201321212100030400232200302021301334213200132021324000322130421324213340133200300203001133421330012300121201320113220122201330013222133401330002320132201332012322121011322003240003401332213340132201220202300132221330202300133001332012120133221332212120122421322013320133201303200222122201234013040023001222013300133001330012220132421332213200130400222013320133001212010340132400230002002123001334013022033000030013222132010321002111123011332012120132001334213302122201322213320132201224012122000400020202242133201330002130130300222210320130220031113320123001220213322132421332002320003401332013200133001212210042133401212213340133401324000302133001324013340133000032002200123001330213320123421332013302023221322002300133001321113222133421330013340022201224013202122201334002320130201334200320133000232012132130201324013020123021230213200121220304213300130201222013240133'

G = 1000000000000
cycle_count, final_index = divmod(G - len(A), len(B))

print(sum(map(int, A)) + cycle_count * sum(map(int, B)) + sum(map(int, B[:final_index])))
